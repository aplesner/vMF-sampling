Bootstrap: docker
From: nvcr.io/nvidia/pytorch:25.06-py3

%post
    apt-get update

    pip3 install --no-cache-dir --upgrade pip
    pip3 install --no-cache-dir \
        pytorch_lightning \
        wandb \
        jupyterlab \
        ipykernel

    # Change this to match the GPUs
    export TORCH_CUDA_ARCH_LIST="7.5;8.0;8.6"  
    pip3 install --no-cache-dir flash-attn --no-build-isolation

%runscript
    python --version
    echo "To run your script, use: apptainer exec pytorch_cuda.sif python /path/to/your/script.py"
    echo "Starting Jupyter Lab..."
    jupyter notebook --no-browser --port 5998 --ip $(hostname -f)
